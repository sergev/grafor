
ГРАФОР(3)	ОС ДЕМОС. Библиотечные функции.       ГРАФОР(3)



ИМЯ

	ГРАФОР - библиотека графического расширения фортрана

РЕАЛИЗАЦИЯ

	Описывается реализация широко распространенной	библио-
	теки ГРАФОР на вычислительном комплексе ИАЭ, включающем
	машины X2 (Unix 4.3 BSD), VAX (Ultrix), AT-286 (Xenix),
	Compaq-386  (Xenix).  В настоящий момент (7.12.89) под-
	держиваются следующие графические устройства: терминалы
	Tektronix  4014, Wyse 99, консоль Xenix; принтеры Epson
	80, HP LaserJet. Возможна  запись  изображений	в  файл
	(метафайл)  и последующая отрисовка на любом из указан-
	ных устройств или в MSDOS.

	ГРАФОР	представляет  собой  библиотеку  подпрограмм  и
	функций  на  фортране,	предназначенную  для построения
	графиков, рисунков и более сложных изображений.  Данная
	реализация  позволяет  записывать рисунок в файл (мета-
	файл) в формате, не зависящем от конкретного  графичес-
	кого устройства.  Прилагаются программы для отрисовки и
	печати метафайлов.

	Полное описание графора можно найти в книге: Баяковский
	Ю. М., Галактионов В. А., Михайлова Т. Н.  Графор. Гра-
	фическое расширение фортрана.	-  М.:	Наука.	Главная
	редакция физико-математической литературы, 1985.

ВЫЗОВ БИБЛИОТЕКИ ПРИ ТРАНСЛЯЦИИ

	Для X2 под ОС Unix 4.3 BSD:

		fc -O2 файлы -lgrafor

	Для VAX под ОС Ultrix, компилятор f77:

		f77 файлы -lgrafor

	Для AT-286 под ОС Xenix, компилятор Microsoft Fortran:

		cl -Ox -FPi файлы -lgrafor -link -S 256

	Для Compaq-386 под ОС Xenix, компилятор NDP Fortran:

		mf77 -O -i файлы -lgrafor

	Компилятор fort на ЭВМ VAX в настоящее время не поддер-
	живается.

ОПИСАНИЕ ОСОБЕННОСТЕЙ

	Максимальный размер страницы по вертикали и горизонтали
	равен 32.767 единиц. При отрисовке на конкретное графи-
	ческое устройство страница масштабируется  на  реальный
	физический лист устройства.  Соотношение геометрических
	размеров при этом сохраняется (круг остается круглым).


			      -1-


ГРАФОР(3)	ОС ДЕМОС. Библиотечные функции.       ГРАФОР(3)



	Подпрограммы инициализации GRINIT и GREND  вызывать  не
	обязательно.

	Выходить за рамки страницы не рекомендуется.

	Подпрограмма ENDPG свой параметр не использует.

	При выводе надписей функцией SYMBOL шрифт  0  представ-
	ляет  собой  стандартную  кодировку  КОИ-8,  в шрифте 1
	латинские и русские буквы  меняются  местами,  шрифт  2
	содержит  греческие буквы в кодировке ASCII, в шрифте 3
	большие и малые буквы меняются местами.

	Переключение цвета производится вызовом:

		call SETPEN (ncolor)

	где ncolor - номер цвета. По умолчанию	устанавливается
	цвет с номером 1.  Цвета нумеруются следующим образом:

		0 - черный (фон)
		1 - белый
		2 - красный
		3 - зеленый
		4 - синий
		5 - желтый
		6 - голубой
		7 - лиловый

	Для записи в метафайл комментариев добавлен вызов:

		call COMMNT (s, n)

	Здесь s - текстовая строка, n - ее длина в символах.

	Для  совместимости  с  Дубненской  библиотекой	 введен
	вызов:

		call PAINT (ncolor, x, y)

	- заливка до границы.  В  данной  версии  эта  операция
	отрабатывает  вхолостую,  хотя	в метафайл записывается
	соответствующая команда.

СТАНДАРТНЫЙ ВЫВОД

	По умолчанию стандартным выводом  является  графический
	дисплей.   Наличие  графического  дисплея  определяется
	глобальной переменной TERM.  При TERM=4014 -  графичес-
	ким  дисплеем является Tektronix, а при TERM=wyse99 или
	wyse99f - Wyse 99. В ОС XENIX консоль  является  графи-
	ческим	дисплеем  при  условии установленной библиотеки
	CGI  и	глобальных  переменных	VDIPATH=/usr/lib/cgi  и
	DISPLAY='ega  /dev/tty'.   При	отсутствии графического
	дисплея по умолчанию стандартный вывод	направляется  в
	файл "grafor.mtf".



			      -2-


ГРАФОР(3)	ОС ДЕМОС. Библиотечные функции.       ГРАФОР(3)



УПРАВЛЕНИЕ ВЫВОДОМ

	Если стандартный вывод перенаправлен  в  файл,	рисунок
	выводится в этот файл в формате метафайла независимо от
	наличия графического дисплея.

	Выводом рисунка в метафайл можно управлять  явно.   Для
	того,  чтобы  записать изображение в метафайл, нужно до
	вызова PAGE задать имя метафайла:

		call SETMTF (name, leng)

	где name - имя метафайла, leng - длина имени  в  симво-
	лах, например:

		call SETMTF ('page.mtf', 8)

	После  закрытия  страницы  подпрограммой  ENDPG,  можно
	переключить  вывод  следующего	рисунка  в другой файл.
	Восстановление стандартного вывода делается вызовом

		call SETSCR

ОТРИСОВКА МЕТАФАЙЛОВ

	Для отрисовки метафайлов на конкретное устройство  при-
	меняются  команды  metaplot и metaprint.  Они считывает
	файлы, указанные в параметрах, или стандартный	ввод  в
	формате  метафайла и строят изображение. Для этих прог-
	рамм глобальные переменные должны  быть  настроены  как
	описано  выше.	При работе в MS DOS стандартным выводом
	является экран.

ФОРМАТ ВЫЗОВА

	metaplot [-e] [-j] [-m] [-r] файл...

	metaprint [-e] [-j] [-r] файл...

ОПИСАНИЕ

	Команда metaplot по умолчанию  выводит	изображение  на
	графический терминал, команда metaprint - в стандартный
	вывод в формате Epson 80.

	После заполнения очередной страницы  делается  задержка
	до  ввода символа с терминала. Можно задавать следующие
	ключи:

	-e	выводить рисунок в стандартный	файл  вывода  в
		формате Epson 80

	-j	выводить рисунок в стандартный	файл  вывода  в
		формате HP LaserJet

	-m	выводить рисунок в стандартный	файл  вывода  в
		формате   метафайла,  применяется  для	слияния


			      -3-


ГРАФОР(3)	ОС ДЕМОС. Библиотечные функции.       ГРАФОР(3)



		нескольких метафайлов в один файл

	-r	повернуть рисунок на 90 градусов

ПРИМЕР ПРОГРАММЫ НА ГРАФОРЕ

	Пусть файл graph.f содержит следующий текст.

	      parameter (n=200, w=3.14, h=1.0e10)
	      dimension x (n), y (n)
	      call setpen (2)
	      call page (32.0, 22.0, 'PAGE GRAFOR', 11, 1)
	      call setpen (7)
	      call region (2.0, 2.0, 28.0, 18.0, 'KIAE', 4, 1)
	      call limits (-w, w, -h, h)
	      call setpen (3)
	      call axes ('X', 1, 0.0, 5, 'Y', 1, 0.0, 5, 11)
	      call setpen (5)
	      do 5 j=1,2
		      do 10 i=1,n
			      x (i) = w * (2. * (i-1)/(n-1) - 1)
			      y (i) = h * sin (x (i) * j)
	10		      continue
		      call lineo (x, y, n)
	5	      continue
	      call endpg (0)
	      end

Трансляция

	Чтобы оттранслировать программу, нужно	дать  следующую
	команду:

	Для X2 под ОС Unix 4.3 BSD:

		% fc -O2 graph.f -lgrafor

	Для VAX под ОС Ultrix, компилятор f77:

		% f77 graph.f -lgrafor

	Для AT-286 под ОС Xenix, компилятор Microsoft Fortran:

		% cl -Ox -FPi graph.f -lgrafor -link -S 256

	Для Compaq-386 под ОС Xenix, компилятор NDP Fortran:

		% mf77 -O -i graph.f -lgrafor

Отрисовка

	Работая на терминале wyse-99 можно  посмотреть	график,
	установив имя терминала 'wyse99' и запустив программу:

		% setenv TERM wyse99
		% a.out



			      -4-


ГРАФОР(3)	ОС ДЕМОС. Библиотечные функции.       ГРАФОР(3)



	В ОС Xenix можно построить  изображение  на  консольном
	дисплее,  при условии наличия в системе библиотеки CGI.
	Для  этого  нужно  установить	глобальные   переменные
	DISPLAY и VDIPATH:

		% setenv DISPLAY 'ega /dev/tty'
		% setenv VDIPATH /usr/lib/cgi
		% a.out

	Можно сбросить рисунок в метафайл и  отрисовать  его  в
	MSDOS.	Для этого нужно:

		- Сбросить график в файл graph.mtf:

			  % a.out > graph.mtf

		- Каким-либо образом  перенести  файл  в  MSDOS
		  (например, переслать по сети).

		- Нарисовать файл на экране командой:

			  C>metaplot graph.mtf

Печать графика

	Чтобы отпечатать график на принтере Oki Microline 393c,
	подключенном к ЭВМ X2 (сетевое имя 'cpux3'), нужно дать
	команду:

		% metaprint -e graph.mtf | ???

	Чтобы отпечатать график на принтере HP LaserJet,  подк-
	люченном  к ЭВМ Compaq-386 (сетевое имя 'berta'), нужно
	дать команду:

		% metaprint -e graph.mtf | lp -dlj -og





















			      -5-



