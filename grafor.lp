
ГГРРААФФООРР((33))       ООСС ДДЕЕММООСС.. ББииббллииооттееччнныыее ффууннккццииии..       ГГРРААФФООРР((33))



ИИММЯЯ

        ГРАФОР - библиотека графического расширения фортрана

РРЕЕААЛЛИИЗЗААЦЦИИЯЯ

        Описывается реализация широко распространенной  библио-
        теки ГРАФОР на вычислительном комплексе ИАЭ, включающем
        машины X2 (Unix 4.3 BSD), VAX (Ultrix), AT-286 (Xenix),
        Compaq-386  (Xenix).  В настоящий момент (7.12.89) под-
        держиваются следующие графические устройства: терминалы
        Tektronix  4014, Wyse 99, консоль Xenix; принтеры Epson
        80, HP LaserJet. Возможна  запись  изображений  в  файл
        (метафайл)  и последующая отрисовка на любом из указан-
        ных устройств или в MSDOS.

        ГГРРААФФООРР  представляет  собой  библиотеку  подпрограмм  и
        функций  на  фортране,  предназначенную  для построения
        графиков, рисунков и более сложных изображений.  Данная
        реализация  позволяет  записывать рисунок в файл (мета-
        файл) в формате, не зависящем от конкретного  графичес-
        кого устройства.  Прилагаются программы для отрисовки и
        печати метафайлов.

        Полное описание графора можно найти в книге: Баяковский
        Ю. М., Галактионов В. А., Михайлова Т. Н.  ГГррааффоорр.. ГГрраа--
        ффииччеессккооее рраассшшииррееннииее ффооррттррааннаа..   -  М.:  Наука.  Главная
        редакция физико-математической литературы, 1985.

ВВЫЫЗЗООВВ ББИИББЛЛИИООТТЕЕККИИ ППРРИИ ТТРРААННССЛЛЯЯЦЦИИИИ

        Для X2 под ОС Unix 4.3 BSD:

                ffcc -O2 _ф_а_й_л_ы -lggrraaffoorr

        Для VAX под ОС Ultrix, компилятор f77:

                ff7777 _ф_а_й_л_ы -lggrraaffoorr

        Для AT-286 под ОС Xenix, компилятор Microsoft Fortran:

                ccll -Ox -FPi _ф_а_й_л_ы -lggrraaffoorr -link -S 256

        Для Compaq-386 под ОС Xenix, компилятор NDP Fortran:

                mmff7777 -O -i _ф_а_й_л_ы -lggrraaffoorr

        Компилятор fort на ЭВМ VAX в настоящее время не поддер-
        живается.

ООППИИССААННИИЕЕ ООССООББЕЕННННООССТТЕЕЙЙ

        Максимальный размер страницы по вертикали и горизонтали
        равен 32.767 единиц. При отрисовке на конкретное графи-
        ческое устройство страница масштабируется  на  реальный
        физический лист устройства.  Соотношение геометрических
        размеров при этом сохраняется (круг остается круглым).


                              -1-


ГГРРААФФООРР((33))       ООСС ДДЕЕММООСС.. ББииббллииооттееччнныыее ффууннккццииии..       ГГРРААФФООРР((33))



        Подпрограммы инициализации GRINIT и GREND  вызывать  не
        обязательно.

        Выходить за рамки страницы не рекомендуется.

        Подпрограмма ENDPG свой параметр не использует.

        При выводе надписей функцией SYMBOL шрифт  0  представ-
        ляет  собой  стандартную  кодировку  КОИ-8,  в шрифте 1
        латинские и русские буквы  меняются  местами,  шрифт  2
        содержит  греческие буквы в кодировке ASCII, в шрифте 3
        большие и малые буквы меняются местами.

        Переключение цвета производится вызовом:

                call SETPEN (ncolor)

        где ncolor - номер цвета. По умолчанию  устанавливается
        цвет с номером 1.  Цвета нумеруются следующим образом:

                0 - черный (фон)
                1 - белый
                2 - красный
                3 - зеленый
                4 - синий
                5 - желтый
                6 - голубой
                7 - лиловый

        Для записи в метафайл комментариев добавлен вызов:

                call COMMNT (s, n)

        Здесь s - текстовая строка, n - ее длина в символах.

        Для  совместимости  с  Дубненской  библиотекой   введен
        вызов:

                call PAINT (ncolor, x, y)

        - заливка до границы.  В  данной  версии  эта  операция
        отрабатывает  вхолостую,  хотя  в метафайл записывается
        соответствующая команда.

ССТТААННДДААРРТТННЫЫЙЙ ВВЫЫВВООДД

        По умолчанию стандартным выводом  является  графический
        дисплей.   Наличие  графического  дисплея  определяется
        глобальной переменной TERM.  При TERM=4014 -  графичес-
        ким  дисплеем является Tektronix, а при TERM=wyse99 или
        wyse99f - Wyse 99. В ОС XENIX консоль  является  графи-
        ческим  дисплеем  при  условии установленной библиотеки
        CGI  и  глобальных  переменных  VDIPATH=/usr/lib/cgi  и
        DISPLAY='ega  /dev/tty'.   При  отсутствии графического
        дисплея по умолчанию стандартный вывод  направляется  в
        файл "grafor.mtf".



                              -2-


ГГРРААФФООРР((33))       ООСС ДДЕЕММООСС.. ББииббллииооттееччнныыее ффууннккццииии..       ГГРРААФФООРР((33))



УУППРРААВВЛЛЕЕННИИЕЕ ВВЫЫВВООДДООММ

        Если стандартный вывод перенаправлен  в  файл,  рисунок
        выводится в этот файл в формате метафайла независимо от
        наличия графического дисплея.

        Выводом рисунка в метафайл можно управлять  явно.   Для
        того,  чтобы  записать изображение в метафайл, нужно до
        вызова PAGE задать имя метафайла:

                call SETMTF (name, leng)

        где name - имя метафайла, leng - длина имени  в  симво-
        лах, например:

                call SETMTF ('page.mtf', 8)

        После  закрытия  страницы  подпрограммой  ENDPG,  можно
        переключить  вывод  следующего  рисунка  в другой файл.
        Восстановление стандартного вывода делается вызовом

                call SETSCR

ООТТРРИИССООВВККАА ММЕЕТТААФФААЙЙЛЛООВВ

        Для отрисовки метафайлов на конкретное устройство  при-
        меняются  команды  mmeettaapplloott и mmeettaapprriinntt.  Они считывает
        файлы, указанные в параметрах, или стандартный  ввод  в
        формате  метафайла и строят изображение. Для этих прог-
        рамм глобальные переменные должны  быть  настроены  как
        описано  выше.  При работе в MS DOS стандартным выводом
        является экран.

ФФООРРММААТТ ВВЫЫЗЗООВВАА

        mmeettaapplloott [-e] [-j] [-m] [-r] _ф_а_й_л...

        mmeettaapprriinntt [-e] [-j] [-r] _ф_а_й_л...

ООППИИССААННИИЕЕ

        Команда metaplot по умолчанию  выводит  изображение  на
        графический терминал, команда metaprint - в стандартный
        вывод в формате Epson 80.

        После заполнения очередной страницы  делается  задержка
        до  ввода символа с терминала. Можно задавать следующие
        ключи:

        -e      выводить рисунок в стандартный  файл  вывода  в
                формате Epson 80

        -j      выводить рисунок в стандартный  файл  вывода  в
                формате HP LaserJet

        -m      выводить рисунок в стандартный  файл  вывода  в
                формате   метафайла,  применяется  для  слияния


                              -3-


ГГРРААФФООРР((33))       ООСС ДДЕЕММООСС.. ББииббллииооттееччнныыее ффууннккццииии..       ГГРРААФФООРР((33))



                нескольких метафайлов в один файл

        -r      повернуть рисунок на 90 градусов

ППРРИИММЕЕРР ППРРООГГРРААММММЫЫ ННАА ГГРРААФФООРРЕЕ

        Пусть файл graph.f содержит следующий текст.

              parameter (n=200, w=3.14, h=1.0e10)
              dimension x (n), y (n)
              call setpen (2)
              call page (32.0, 22.0, 'PAGE GRAFOR', 11, 1)
              call setpen (7)
              call region (2.0, 2.0, 28.0, 18.0, 'KIAE', 4, 1)
              call limits (-w, w, -h, h)
              call setpen (3)
              call axes ('X', 1, 0.0, 5, 'Y', 1, 0.0, 5, 11)
              call setpen (5)
              do 5 j=1,2
                      do 10 i=1,n
                              x (i) = w * (2. * (i-1)/(n-1) - 1)
                              y (i) = h * sin (x (i) * j)
        10                    continue
                      call lineo (x, y, n)
        5             continue
              call endpg (0)
              end

ТТррааннсслляяцциияя

        Чтобы оттранслировать программу, нужно  дать  следующую
        команду:

        Для X2 под ОС Unix 4.3 BSD:

                % fc -O2 graph.f -lgrafor

        Для VAX под ОС Ultrix, компилятор f77:

                % f77 graph.f -lgrafor

        Для AT-286 под ОС Xenix, компилятор Microsoft Fortran:

                % cl -Ox -FPi graph.f -lgrafor -link -S 256

        Для Compaq-386 под ОС Xenix, компилятор NDP Fortran:

                % mf77 -O -i graph.f -lgrafor

ООттррииссооввккаа

        Работая на терминале wyse-99 можно  посмотреть  график,
        установив имя терминала 'wyse99' и запустив программу:

                % setenv TERM wyse99
                % a.out



                              -4-


ГГРРААФФООРР((33))       ООСС ДДЕЕММООСС.. ББииббллииооттееччнныыее ффууннккццииии..       ГГРРААФФООРР((33))



        В ОС Xenix можно построить  изображение  на  консольном
        дисплее,  при условии наличия в системе библиотеки CGI.
        Для  этого  нужно  установить   глобальные   переменные
        DISPLAY и VDIPATH:

                % setenv DISPLAY 'ega /dev/tty'
                % setenv VDIPATH /usr/lib/cgi
                % a.out

        Можно сбросить рисунок в метафайл и  отрисовать  его  в
        MSDOS.  Для этого нужно:

                - Сбросить график в файл graph.mtf:

                          % a.out > graph.mtf

                - Каким-либо образом  перенести  файл  в  MSDOS
                  (например, переслать по сети).

                - Нарисовать файл на экране командой:

                          C>metaplot graph.mtf

ППееччааттьь ггррааффииккаа

        Чтобы отпечатать график на принтере Oki Microline 393c,
        подключенном к ЭВМ X2 (сетевое имя 'cpux3'), нужно дать
        команду:

                % metaprint -e graph.mtf | ???

        Чтобы отпечатать график на принтере HP LaserJet,  подк-
        люченном  к ЭВМ Compaq-386 (сетевое имя 'berta'), нужно
        дать команду:

                % metaprint -e graph.mtf | lp -dlj -og





















                              -5-



